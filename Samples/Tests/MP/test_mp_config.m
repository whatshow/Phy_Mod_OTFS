clear;
clc;

% OTFS parameters
N = 7; % number of symbol
M = 7; % number of subcarriers
pos_mid = 4;

M_mod = 4;
M_bits = log2(M_mod);
eng_sqrt = (M_mod==2)+(M_mod~=2)*sqrt((M_mod-1)/6*(2^2));
% number of symbols per frame
N_syms_perfram = N*M;
% number of bits per frame
N_bits_perfram = N*M*M_bits;

SNR_dB = 20;
SNR = 10.^(SNR_dB/10);
noise_var_sqrt = sqrt(1./SNR);
sigma_2 = abs(eng_sqrt*noise_var_sqrt).^2;

noise = sqrt(sigma_2/2)*[-1.42497597512252 + 0.0260186363012759i;
        -1.45411112015933 + 2.00553635420779i;
        -1.80931648036793 - 1.12963130105680i;
        -1.46294717269402 + 0.654236869385572i;
        -0.138067504850374 + 1.41916666165328i;
        -1.00559188795698 - 0.825612778293049i;
        -2.73330434066687 + 0.0531067702556539i;
        1.69240496692970 - 0.855854647096344i;
        -0.283385506071530 + 1.76811828282612i;
        1.12214234095007 + 0.182870706386307i;
        -0.306948458587744 + 0.431021832118606i;
        -0.168531423962066 - 0.228818088805040i;
        -0.0813077173088029 + 0.393996663746908i;
        -0.0377175030202434 - 0.525874639225718i;
        2.09138943321413 - 2.44696013529974i;
        -0.410629616516801 + 0.155245392087599i;
        2.95757015441396 - 0.834079027680598i;
        -1.68738892285585 + 0.0784677348649857i;
        0.290257353747172 + 1.31271004175894i;
        -1.46935240703217 - 0.135124367253085i;
        0.449061780062092 - 1.40999549868789i;
        -1.69589482799804 - 0.162703275625412i;
        0.0604605855386100 + 2.10983615252955i;
        -1.14761248514479 + 1.46258581887965i;
        1.99393615545747 + 0.914105520335594i;
        0.920891651423923 + 1.51214473168008i;
        1.62270079012959 - 0.454164535979311i;
        -0.487547332849878 - 1.13940317994223i;
        -1.19558192699455 - 0.705496999016342i;
        -1.41946978437913 - 0.331098302059917i;
        0.468219636807238 - 1.52079225854241i;
        1.32992391508012 + 0.165279375567899i;
        2.30471703618212 - 0.487869920298793i;
        0.851428879735412 + 0.586965259687663i;
        0.521838577151225 - 0.903369254574816i;
        3.20129329948546 + 0.371007954483717i;
        -0.330453340873141 - 1.26014297411022i;
        -0.896355554522242 + 0.222889374683399i;
        -0.993949914217387 - 0.413063804734109i;
        -1.87166882526623 - 1.01666790498812i;
        1.49786930748773 - 0.326022707046303i;
        -1.63244672887591 + 0.283502122171123i;
        -0.851816931598757 - 0.0115687363522061i;
        1.07740026904607 + 0.0362673831189453i;
        -0.440098573261119 - 1.09830300790239i;
        3.32798405036193 + 0.375682612993207i;
        0.103795549574524 + 0.170054802988250i;
        -0.773078762688917 + 1.13966800506499i;
        0.677374438846291 + 1.65746365792322i;
        -0.696817323443915 + 0.338247945641554i;
        -0.0753512238546296 - 1.81897060113566i];